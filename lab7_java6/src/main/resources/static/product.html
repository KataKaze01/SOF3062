<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quản lý Sản phẩm</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<div id="app" class="container mt-4">
    <h2 class="text-center">QUẢN LÝ SẢN PHẨM</h2>
    <div class="row">
        <div class="col-md-5">
            <div class="card p-3">
                <div class="mb-2"><label>Tên SP:</label> <input v-model="form.name" class="form-control"></div>
                <div class="mb-2"><label>Giá:</label> <input v-model="form.price" type="number" class="form-control"></div>
                <div class="mb-2"><label>Ngày nhập:</label> <input v-model="form.createDate" type="date" class="form-control"></div>
                <div class="mb-3"><label>Loại hàng:</label>
                    <select v-model="form.category.id" class="form-control">
                        <option v-for="c in categories" :value="c.id">{{c.name}}</option>
                    </select>
                </div>
                <div>
                    <button @click="create()" class="btn btn-primary">Create</button>
                    <button @click="update()" class="btn btn-success">Update</button>
                    <button @click="deleteProd(form.id)" class="btn btn-danger" :disabled="!form.id">Delete</button>
                    <button @click="reset()" class="btn btn-secondary">Reset</button>
                </div>
            </div>
        </div>
        <div class="col-md-7">
            <table class="table table-bordered table-striped">
                <thead><tr><th>ID</th><th>Tên SP</th><th>Giá</th><th>Ngày</th><th>Loại</th><th></th></tr></thead>
                <tbody>
                    <tr v-for="item in items" :key="item.id">
                        <td>{{item.id}}</td>
                        <td>{{item.name}}</td>
                        <td>{{item.price}}</td>
                        <td>{{item.createDate}}</td>
                        <td>{{item.category ? item.category.name : ''}}</td>
                        <td><button @click="edit(item)" class="btn btn-sm btn-info">Edit</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    new Vue({
        el: '#app',
        data: {
            items: [], categories: [],
            form: { id: null, name: '', price: 0, createDate: '', category: { id: '' } }
        },
        mounted() { this.load(); this.loadCategories(); },
        methods: {
            load() { axios.get('/rest/products').then(resp => this.items = resp.data); },
            loadCategories() { axios.get('/rest/categories').then(resp => this.categories = resp.data); },
            edit(item) { this.form = JSON.parse(JSON.stringify(item)); }, // Deep copy
            // Tìm đoạn này trong methods của Vue
create() {
    this.form.id = null; // <--- THÊM DÒNG NÀY: Đảm bảo ID luôn null khi tạo mới
    axios.post('/rest/products', this.form).then(() => {
        this.load();
        this.reset();
        alert('Thêm thành công!');
    });
},
            update() { axios.put('/rest/products/' + this.form.id, this.form).then(() => { this.load(); alert('Cập nhật thành công!'); }); },
            deleteProd(id) { if(confirm('Xóa nhé?')) axios.delete('/rest/products/' + id).then(() => { this.load(); this.reset(); }); },
            reset() { this.form = { id: null, name: '', price: 0, createDate: '', category: { id: '' } }; }
        }
    });
</script>
</body>
</html>